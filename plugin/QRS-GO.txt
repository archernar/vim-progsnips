#!/usr/bin/ksh
Tmp="/tmp/$$"
TmpDir="/tmp/dir$$"
trap 'rm -f "$Tmp" >/dev/null 2>&1' 0
trap "exit 2" 1 2 3 13 15
rm -f "$Tmp" >/dev/null 2>&1

while getopts "a:f:b:v:um:c" arg
do
	case $arg in
            f) yt-dlp -F "$OPTARG"
               exit 0
               ;;
            b) yt-dlp -f 'ba' "$OPTARG"
               exit 0
               ;;
            v) yt-dlp -f 'bv*+ba' "$OPTARG"
               exit 0
               ;;
            u) wget https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp -O ./yt-dlp
               chmod a+rx ./yt-dlp
               exit 0
               ;;
            a) ./yt-dlp -f 140 $OPTARG
               exit 0
               ;;
            m) ./yt-dlp -f 140 $OPTARG
               exit 0
               ;;
            c) rm -f *.mp3
               for f in *.m4a ; do ffmpeg -i "$f" -ab 320k "${f%.m4a}.mp3"; done
               mv *.mp3 MP3
               ls -lh MP3
               exit 0
               ;;
	esac
done
shift $(($OPTIND - 1))

# ffmpeg -i "concat:1.mp3|2.mp3" -acodec copy output.mp3

# yt-dlp -f 'bv*[ext=mp4]+ba[ext=m4a]/b[ext=mp4] / bv*+ba/b'
#
rm -f *.webm
rm -f *.m4a
rm -f *.mp3

./yt-dlp -f 140 $1

# for f in *.m4a ; do ffmpeg -i "$f" -ab 320k "${f%.m4a}.mp3"; done
for f in *.m4a ; do ffmpeg -i "$f" -q:a 0 -map a "${f%.m4a}.mp3"; done


# ffmpeg -i in.mp4 -q:a 0 -map a out.mp3
# https://www.youtube.com/playlist?list=PLsDZ7QcsbDR9Qj_6vPr6gp-OgGBm-3RTp


mv *.mp3 MP3
rm -f *.m4a


:q!s -lh MP3
